!function(t){var e={};function n(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(o,a,function(e){return t[e]}.bind(null,a));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);n(1)},function(t,e){const n="https://nikolay0951-api.herokuapp.com";let o=0,a=0;const r=document.getElementById("root"),s=document.createElement("form");s.className="form-inline mb-2",s.innerHTML='\n    <div class="form-group">\n        <input class="form-control" data-id="content" placeholder="Введите текст или url источника" size="30">\n    </div>\n    <select class="custom-select" data-id="type">\n        <option value="regular">Обычный</option>\n        <option value="image">Изображение</option>\n        <option value="audio">Аудио</option>\n        <option value="video">Видео</option>\n    </select>\n    <button class="btn btn-info">Добавить</button>\n',r.appendChild(s),b();const c=s.querySelector("[data-id=content]");c.value=localStorage.getItem("content"),c.addEventListener("input",t=>{localStorage.setItem("content",c.value)});const i=s.querySelector("[data-id=type]");i.value=localStorage.getItem("type")||"regular",i.addEventListener("input",t=>{localStorage.setItem("type",i.value)}),s.addEventListener("submit",t=>{t.preventDefault();const e={content:c.value,type:i.value};fetch(`${n}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.json()}).then(t=>{c.value="",i.value="regular",localStorage.clear(),p(t)}).catch(t=>{console.log(t)})}),r.appendChild(s);const l=document.createElement("button");l.textContent="Показать новые записи",l.className="btn btn-info btn-block",l.style.display="none",l.addEventListener("click",()=>{fetch(`${n}/posts/newPosts/${o}`).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.json()}).then(t=>{l.style.display="none",console.log(t),p(t)}).catch(t=>{console.log(t)})}),r.appendChild(l);const d=document.createElement("div");r.appendChild(d);const u=document.createElement("button");function b(){fetch(`${n}/posts/seenPosts/${a}`).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.json()}).then(t=>{console.log(t),function(t){if(t.reverse(),t.length<5){if(u.style.display="none",0===t.length)return}else fetch(`${n}/posts/poll-seenPosts/${t[t.length-1].id}`).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.text()}).then(t=>{console.log(t),"true"===t&&(ddOldPostsButtonEl.style.display="block")}).catch(t=>{console.log(t)});0===o&&(o=t[0].id);a=t[t.length-1].id;for(const e of t)d.appendChild(f(e))}(t)}).catch(t=>{console.log(t)})}function p(t){if(0!==t.length)if(Array.isArray(t)){o=t[0].id;for(const e of t)d.insertBefore(f(e),d.children[0])}else o=t.id,d.insertBefore(f(t),d.children[0])}function f(t){const e=document.createElement("div");return e.className="card-posts","regular"===t.type?e.innerHTML=`\n        <div class="card">\n            <div class="card-body">\n                <p class="card-text">${t.content}</p>\n                <button class="btn btn-primary" data-action="like">👍🏼 ${t.likes}</button>\n                <button class="btn btn-secondary" data-action="dislike">👎🏻</button>\n                <button class="btn btn-danger" data-action="delete">X</button>\n            </div>\n        </div>\n        `:"image"===t.type?e.innerHTML=`\n        <div class="card">\n            <img src="${t.content}" class="card-img-top">\n            <div class="card-body">\n                <button class="btn btn-primary" data-action="like">👍🏼 ${t.likes}</button>\n                <button class="btn btn-secondary" data-action="dislike">👎🏻</button>\n                <button class="btn btn-danger" data-action="delete">X</button>\n            </div>\n        </div>\n        `:"video"===t.type?e.innerHTML=`\n        <div class="card">\n            <div class="embed-responsive embed-responsive-16by9">\n                 <iframe class="embed-responsive-item" src="${t.content}"></iframe>\n            </div>\n            <div class="card-body">\n                <button class="btn btn-primary" data-action="like">👍🏼 ${t.likes}</button>\n                <button class="btn btn-secondary" data-action="dislike">👎🏻</button>\n                <button class="btn btn-danger" data-action="delete">X</button>\n            </div>\n        </div>\n        `:"audio"===t.type&&(e.innerHTML=`\n        <div class="card">\n            <div class="card-img-top">\n                <audio src="${t.content}" controls></audio>\n            </div>\n            <div class="card-body">\n                <button class="btn btn-primary" data-action="like">👍🏼 ${t.likes}</button>\n                <button class="btn btn-secondary" data-action="dislike">👎🏻</button>\n                <button class="btn btn-danger" data-action="delete">X</button>\n            </div>\n        </div>\n        `),e.querySelector("[data-action=like]").addEventListener("click",o=>{fetch(`${n}/posts/${t.id}/likes`,{method:"POST"}).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.json()}).then(t=>{e.querySelector("[data-action=like]").textContent=`👍🏼 ${t}`}).catch(t=>{console.log(t)})}),e.querySelector("[data-action=dislike]").addEventListener("click",o=>{fetch(`${n}/posts/${t.id}/likes/`,{method:"DELETE"}).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.json()}).then(t=>{e.querySelector("[data-action=like]").textContent=`👍🏼 ${t}`}).catch(t=>{console.log(t)})}),e.querySelector("[data-action=delete]").addEventListener("click",o=>{fetch(`${n}/posts/${t.id}`,{method:"DELETE"}).then(t=>{if(!t.ok)throw new Error(t.statusText)}).catch(t=>{console.log(t)}),d.removeChild(e)}),e}u.textContent="Предыдущие записи",u.className="btn btn-info btn-block",u.addEventListener("click",()=>{b(),u.style.display="none"}),r.appendChild(u),setInterval(()=>{fetch(`${n}/posts/poll/${o}`).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.text()}).then(t=>{"false"!==t&&(l.style.display="block")}).catch(t=>{console.log(t)})},5e3)}]);